# APP4-1 

This is the ACCESS Post-Processor (APP), version 4.1

Initially created by Peter Uhe for CMIP5, and further developed for CMIP6-era by Chloe Mackallah.  
CSIRO, O&A Aspendale.

---

The APP4 is a CMORisation tool designed to convert [ACCESS](https://research.csiro.au/access/) model output to [ESGF](https://esgf-node.llnl.gov/)-compliant formats, primarily for publication to [CMIP6](https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6). 
The code was originally built for CMIP5, and was further developed for CMIP6-era activities. 
Uses [CMOR3](https://cmor.llnl.gov/) and files created with the [CMIP6 data request](https://github.com/cmip6dr/dreqPy) to generate CF-compliant files according to the [CMIP6 data standards](https://docs.google.com/document/d/1os9rZ11U0ajY7F8FWtgU4B49KcB59aFlBVGfLC4ahXs/edit).  

Supported versions are CM2 (coupled, amip & chem versions), ESM1.5 (script & payu versions), OM2[-025]. 
For use on NCI's [Gadi](https://opus.nci.org.au/display/Help/Gadi+User+Guide) system only. 
Designed for use on ACCESS model output that has been archived using the ACCESS Archiver tool.

## Custom Mode

In custom mode, the APP4 can process non-CMIP6 experiments, allowing the user to create CMORise using custom metadata (experiment ids, MIP names, etc) rather than requiring the use of the [CMIP6 Controlled Vocabulary](https://github.com/WCRP-CMIP/CMIP6_CVs). However, only CMIP6 variables can be generated (CCMI2022 also included for CM2-Chem model).

***custom_app4.sh***  
This is main control script for the APP4 in custom mode. Here you define:  
- Details about the experiment you wish to process, including the location of the archived data (see https://git.nci.org.au/cm2704/ACCESS-Archiver) and version of ACCESS.
- Metadata intended for the final datasets, including experiment and MIP names, ensemble number and branch times, for both the present experiment, and its parent experiment (if applicable; 'no parent' can also be used by setting *parent* to false).
- The variable(s) to process and generate. These can be set either by declaring a MIP Table (e.g., Amon, SIday, etc.) and variable (CMIP6 names) in the wrapper, or by creating a file-based list of variables (*VAR_SUBSET_LIST*) to read in.  
The CMIP6 data request file to use for variable definitions is also defined here. A default file that contains all APP4-ready CMIP6 variables can also be selected.
- NCI job information, including the intended write location of CMORised data and job files, and declaring job details (compute project, job queue (hugemem is recommended), and cpu/memory usage).

Once all variables have been set, simply run the script with ./custom_app4.sh to create the necessary files (job script, variable maps, etc) and submit the task to the queue.

***check_app4.sh***  
This script can be used to perform a simple sweep on your CMORised data to see which variables succeeded, and if any failed to generate (or only completed for some years). It does not check the data itself, but scans through the job output files to provide a summary of what was generated by the job.  
You can set the local experiment name and output data location manually, or have the script read these from *custom_app4.sh* (by setting READ_FROM_CUSTOM_WRAPPER=true).

Further job logs and information can be found in the job output file (*$OUTPUT_LOC/APP_job_files/${EXP_TO_PROCESS}/job_output.OU*) and in the variable logs (*$OUTPUT_LOC/APP_job_files/${EXP_TO_PROCESS}/variable_logs*). Lists of successful and failed variables are stored in (*$OUTPUT_LOC/APP_job_files/${EXP_TO_PROCESS}/success_lists/*).  
The CMOR logs (*$OUTPUT_LOC/APP_job_files/cmor_logs*) are overwritten by CMOR everytime it generates a file, and so for CMOR-specific log information you must run each problematic variable at time (variable/table declared in *custom_app4.sh*).

